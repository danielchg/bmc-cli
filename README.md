# BMC CLI Tool

> **NOTE**
> 
> All the code hold in this repos have been generated by AI using Cursor IDE. This is just an experiment on how to create a project using an AI based IDE.
>

A command-line tool for managing Baseboard Management Controllers (BMCs) including both HP iLO (Integrated Lights-Out) and DELL iDRAC systems. This tool provides functionality to power on/off servers, mount virtual media, and manage server configurations through the Redfish API.

## Features

- **Multi-Vendor Support**: Works with both HPE iLO and DELL iDRAC BMCs
- **Power Management**: Power on, power off, and check server power status
- **Virtual Media**: Mount and unmount ISO images as virtual media
- **Configuration**: Flexible configuration via YAML files or environment variables
- **Secure**: Supports HTTPS with self-signed certificate handling
- **Verbose Logging**: Optional verbose output for debugging

## Installation

### Prerequisites

- Go 1.19 or later

### Build from Source

```bash
git clone <repository-url>
cd bmc-cli
go build -o bmc-cli
```

## Configuration

The tool supports configuration through both YAML files and environment variables. You need to specify the BMC type (ilo or idrac) and the corresponding connection details.

### Environment Variables

#### For HPE iLO:
```bash
export BMC_TYPE="ilo"
export ILO_HOST="192.168.1.100"
export ILO_USERNAME="admin"
export ILO_PASSWORD="password"
export ILO_PORT="443"
export ILO_USE_HTTPS="true"
```

#### For DELL iDRAC:
```bash
export BMC_TYPE="idrac"
export IDRAC_HOST="192.168.1.101"
export IDRAC_USERNAME="root"
export IDRAC_PASSWORD="calvin"
export IDRAC_PORT="443"
export IDRAC_USE_HTTPS="true"
```

### YAML Configuration File

Create a `config.yaml` file:

```yaml
# Specify the BMC type: 'ilo' for HPE iLO or 'idrac' for DELL iDRAC
bmc_type: "ilo"

# HPE iLO Configuration
ilo:
  host: "192.168.1.100"
  username: "admin"
  password: "password"
  port: 443
  use_https: true

# DELL iDRAC Configuration  
idrac:
  host: "192.168.1.101"
  username: "root"
  password: "calvin"
  port: 443
  use_https: true
```

Generate a sample configuration file:

```bash
./bmc-cli config generate
```

## Usage

### Power Management

```bash
# Check server power status
./bmc-cli power status

# Power on the server
./bmc-cli power on

# Power off the server (force)
./bmc-cli power off
```

### Virtual Media Management

```bash
# List virtual media slots and status
./bmc-cli virtualmedia list
./bmc-cli vm list  # Short alias

# Mount an ISO image
./bmc-cli virtualmedia mount http://192.168.1.100/images/ubuntu-20.04.iso
./bmc-cli vm mount http://192.168.1.100/images/ubuntu-20.04.iso

# Unmount all virtual media
./bmc-cli virtualmedia unmount
./bmc-cli vm unmount
```

### Configuration Management

```bash
# Generate sample configuration file
./bmc-cli config generate
```

### Global Options

```bash
# Use custom configuration file
./bmc-cli --config /path/to/config.yaml power status

# Enable verbose output
./bmc-cli --verbose power on
./bmc-cli -v vm mount http://example.com/image.iso
```

## Examples

### Complete Workflow Example

```bash
# 1. Generate configuration file
./bmc-cli config generate

# 2. Edit config.yaml with your BMC credentials
vim config.yaml

# 3. Check server status
./bmc-cli power status

# 4. Mount installation media
./bmc-cli vm mount http://192.168.1.100/images/ubuntu-20.04.iso

# 5. Power on server
./bmc-cli power on

# 6. After installation, unmount media
./bmc-cli vm unmount

# 7. Power off server
./bmc-cli power off
```

### Using Environment Variables

#### For HPE iLO:
```bash
# Set environment variables
export BMC_TYPE="ilo"
export ILO_HOST="192.168.1.100"
export ILO_USERNAME="admin"
export ILO_PASSWORD="secretpassword"

# Use the tool without a config file
./bmc-cli power status
```

#### For DELL iDRAC:
```bash
# Set environment variables
export BMC_TYPE="idrac"
export IDRAC_HOST="192.168.1.101"
export IDRAC_USERNAME="root"
export IDRAC_PASSWORD="secretpassword"

# Use the tool without a config file
./bmc-cli power status
```

## API Compatibility

This tool uses the Redfish API standard and has been tested with:

### HPE iLO:
- HP iLO 4
- HP iLO 5
- HPE iLO 6

### DELL iDRAC:
- iDRAC 8
- iDRAC 9

## Security Considerations

- The tool accepts self-signed certificates by default for BMC compatibility
- Passwords in configuration files should be protected with appropriate file permissions
- Consider using environment variables for passwords in automated environments

## Troubleshooting

### Common Issues

1. **Connection Refused**
   - Verify the BMC IP address and port
   - Check network connectivity
   - Ensure BMC web interface is accessible

2. **Authentication Failed**
   - Verify username and password
   - Check if the account has sufficient privileges
   - Ensure the account is not locked
   - For iDRAC, ensure the user has "Virtual Media" privileges

3. **SSL/TLS Errors**
   - The tool accepts self-signed certificates by default
   - If issues persist, try using HTTP instead of HTTPS (not recommended for production)

4. **BMC Type Configuration**
   - Ensure the correct `bmc_type` is set (ilo or idrac)
   - Use the appropriate environment variables for your BMC type

### Verbose Output

Use the `--verbose` or `-v` flag for detailed logging:

```bash
./bmc-cli -v power status
```

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Support

For issues and questions, please open an issue in the project repository. 